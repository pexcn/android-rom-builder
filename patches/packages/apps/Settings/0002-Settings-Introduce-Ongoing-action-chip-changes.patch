From c82da5814f5528f459f669f04ff56e0a7f78e0c7 Mon Sep 17 00:00:00 2001
From: pexcn <pexcn97@gmail.com>
Date: Wed, 21 May 2025 14:07:20 +0000
Subject: [PATCH 2/2] Settings: Introduce Ongoing action chip changes

ref: https://github.com/ProjectMatrixx/android_packages_apps_MatrixxSettings/commit/17f4ddc2b47e8b64c9b38bd65c95f26f0fafd530
Signed-off-by: pexcn <pexcn97@gmail.com>
---
 res/values-zh-rCN/custom_strings.xml          | 24 ++++++++-
 res/values/custom_strings.xml                 | 26 +++++++++-
 res/xml/display_settings.xml                  | 11 ++--
 res/xml/ongoing_progress_settings.xml         | 51 +++++++++++++++++++
 .../OngoingProgressBar.java                   | 44 ++++++++++++++++
 5 files changed, 147 insertions(+), 9 deletions(-)
 create mode 100644 res/xml/ongoing_progress_settings.xml
 create mode 100644 src/com/android/settings/custom/ongoingprogressbar/OngoingProgressBar.java

diff --git a/res/values-zh-rCN/custom_strings.xml b/res/values-zh-rCN/custom_strings.xml
index 735091c..0de463a 100644
--- a/res/values-zh-rCN/custom_strings.xml
+++ b/res/values-zh-rCN/custom_strings.xml
@@ -268,6 +268,28 @@
     <string name="show_qs_on_secure_keyguard_title">å¿«é€Ÿè®¾ç½®</string>
     <string name="show_qs_on_secure_keyguard_summary">å…è®¸åœ¨é”å±ç•Œé¢ä½¿ç”¨å¿«é€Ÿè®¾ç½®</string>
     <!-- Ongoing action chip -->
+    <string name="ongoing_progress_settings_title">çŠ¶æ€æ æ“ä½œèƒ¶å›Š</string>
+    <string name="ongoing_progress_settings_summary">è‡ªå®šä¹‰çŠ¶æ€æ æ“ä½œèƒ¶å›Š</string>
     <string name="ongoing_action_chip_title">é€šçŸ¥è¿›åº¦æ¡</string>
-    <string name="ongoing_action_chip_summary">åœ¨çŠ¶æ€æ ä¸­æ˜¾ç¤ºé€šçŸ¥è¿›åº¦æ¡</string>
+    <string name="ongoing_action_chip_summary">åœ¨çŠ¶æ€æ ä¸­æ˜¾ç¤ºä¸‹è½½ç­‰æ­£åœ¨è¿›è¡Œçš„æ“ä½œçš„è¿›åº¦æ¡</string>
+    <string name="show_media_progress_title">æ˜¾ç¤ºåª’ä½“è¿›åº¦</string>
+    <string name="show_media_progress_summary">åœ¨çŠ¶æ€æ ä¸­æ˜¾ç¤ºåª’ä½“æ’­æ”¾è¿›åº¦</string>
+    <string name="progress_footer_text">
+    "çŠ¶æ€æ è¿›åº¦æ¡ä¸ºåª’ä½“æ’­æ”¾å’Œæ´»åŠ¨çš„ä¸Šä¼ /ä¸‹è½½æä¾›å®æ—¶æ›´æ–°ã€‚
+
+    - ğŸµ åª’ä½“è¿›åº¦ï¼š
+    â€¢ åœ¨åª’ä½“æ’­æ”¾æ—¶æ˜¾ç¤ºéŸ³ä¹å’Œè§†é¢‘çš„æ’­æ”¾è¿›åº¦ã€‚
+    â€¢ è½»è§¦å¯æ‰“å¼€æ’­æ”¾æ§ä»¶ï¼ˆä¸Šä¸€æ›²ã€ä¸‹ä¸€æ›²ï¼‰ã€‚
+    â€¢ åŒå‡»å¯åˆ‡æ¢æ’­æ”¾/æš‚åœã€‚
+    â€¢ å‘å·¦æ»‘åŠ¨å¯è·³è½¬è‡³ä¸Šä¸€é¦–æ›²ç›®ã€‚
+    â€¢ å‘å³æ»‘åŠ¨å¯è·³è½¬è‡³ä¸‹ä¸€é¦–æ›²ç›®ã€‚
+    â€¢ é•¿æŒ‰å¯æ‰“å¼€åª’ä½“åº”ç”¨ç¨‹åºã€‚
+
+    - ğŸ“¥ä¸Šä¼ /ä¸‹è½½è¿›åº¦ï¼š
+    â€¢ æ˜¾ç¤ºæ­£åœ¨è¿›è¡Œçš„ä¸Šä¼ å’Œä¸‹è½½è¿›åº¦ã€‚
+    â€¢ å½“æœªæ£€æµ‹åˆ°æ´»åŠ¨çš„ä¼ è¾“æ—¶è‡ªåŠ¨éšè—ã€‚
+    â€¢ å•å‡»å¯æ‰“å¼€è´Ÿè´£ä¸‹è½½çš„åº”ç”¨ç¨‹åºã€‚
+
+    è¿›åº¦æ¡åœ¨åª’ä½“å’Œä¸‹è½½çŠ¶æ€ä¹‹é—´åŠ¨æ€åˆ‡æ¢ï¼Œç¡®ä¿æ‚¨å§‹ç»ˆå¯ä»¥ä¸€ç›®äº†ç„¶åœ°è·å¾—æœ€ç›¸å…³çš„ä¿¡æ¯ã€‚"
+    </string>
 </resources>
diff --git a/res/values/custom_strings.xml b/res/values/custom_strings.xml
index 969ea61..3a42c5a 100644
--- a/res/values/custom_strings.xml
+++ b/res/values/custom_strings.xml
@@ -317,7 +317,29 @@
     <string name="show_qs_on_secure_keyguard_summary">Allow toggling quick settings on secure lockscreen</string>
 
     <!-- Ongoing action chip -->
-    <string name="ongoing_action_chip_title">Enable Ongoing ProgressBar Chip</string>
-    <string name="ongoing_action_chip_summary">Show progressbar chip in statusbar which features ongoing action progress from a notification</string>
+    <string name="ongoing_progress_settings_title">Statusbar action chip</string>
+    <string name="ongoing_progress_settings_summary">Statusbar action chip options</string>
+    <string name="ongoing_action_chip_title">Ongoing action chip</string>
+    <string name="ongoing_action_chip_summary">Show progress indicator in status bar for ongoing actions like downloads</string>
+    <string name="show_media_progress_title">Show media progress</string>
+    <string name="show_media_progress_summary">Display media playback progress in the status bar</string>
+    <string name="progress_footer_text">
+    "The status bar progress bar provides real-time updates for both media playback and active downloads/uploads.
+
+    - ğŸµ Media Progress:
+    â€¢ Displays playback progress for music and video when media is playing.
+    â€¢ Single tap opens playback controls (Previous, Next track).
+    â€¢ Double tap toggles play/pause.
+    â€¢ Swipe left skips to the previous track.
+    â€¢ Swipe right skips to the next track.
+    â€¢ Long press opens the media app.
+
+    - ğŸ“¥Download/Upload Progress:
+    â€¢ Shows progress for ongoing downloads and uploads.
+    â€¢ Automatically hides when no active transfers are detected.
+    â€¢ Single tap opens the app responsible for the download.
+
+    The progress bar dynamically switches between media and download states, ensuring you always have the most relevant information at a glance."
+    </string>
 
 </resources>
diff --git a/res/xml/display_settings.xml b/res/xml/display_settings.xml
index 4c38a13..43c78f8 100644
--- a/res/xml/display_settings.xml
+++ b/res/xml/display_settings.xml
@@ -101,12 +101,11 @@
             <intent android:action="com.android.settings.action.STATUS_BAR_TUNER" />
         </Preference>
 
-        <com.android.settings.custom.preference.SystemSettingSwitchPreference
-            android:key="config_enableOngoingProgressBarChip"
-            android:title="@string/ongoing_action_chip_title"
-            android:summary="@string/ongoing_action_chip_summary"
-            android:defaultValue="false"
-            android:persistent="true"/>
+        <Preference
+            android:key="ongoing_progress_settings"
+            android:title="@string/ongoing_progress_settings_title"
+            android:summary="@string/ongoing_progress_settings_summary"
+            android:fragment="com.android.settings.custom.ongoingprogressbar.OngoingProgressBar" />
     </PreferenceCategory>
 
     <PreferenceCategory
diff --git a/res/xml/ongoing_progress_settings.xml b/res/xml/ongoing_progress_settings.xml
new file mode 100644
index 0000000..4ad2fb9
--- /dev/null
+++ b/res/xml/ongoing_progress_settings.xml
@@ -0,0 +1,51 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!--
+     Copyright (C) 2024-2025 the Lunaris-OS Android Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
+<PreferenceScreen
+    xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:settings="http://schemas.android.com/apk/res/com.android.settings"
+    xmlns:app="http://schemas.android.com/apk/res-auto"
+    android:title="@string/ongoing_progress_settings_title" >
+
+    <com.android.settings.custom.preference.SystemSettingSwitchPreference
+        android:key="ongoing_action_chip"
+        android:title="@string/ongoing_action_chip_title"
+        android:summary="@string/ongoing_action_chip_summary"
+        android:defaultValue="true" />
+
+    <com.android.settings.custom.preference.SystemSettingSwitchPreference
+        android:key="show_media_progress"
+        android:title="@string/show_media_progress_title"
+        android:summary="@string/show_media_progress_summary"
+        android:defaultValue="true" />
+
+    <com.android.settings.custom.preference.SystemSettingSeekBarPreference
+        android:key="progress_bar_opacity"
+        android:title="Progress Bar Opacity"
+        android:summary="Adjust the opacity of the progress bar chip"
+        android:defaultValue="100"
+        settings:units="%"
+        settings:interval="1"
+        android:max="100"
+        android:min="0" />
+
+    <com.android.settingslib.widget.FooterPreference
+        android:key="progress_footer"
+        android:title="@string/progress_footer_text"
+        android:selectable="false"
+        settings:searchable="false" />
+
+</PreferenceScreen>
diff --git a/src/com/android/settings/custom/ongoingprogressbar/OngoingProgressBar.java b/src/com/android/settings/custom/ongoingprogressbar/OngoingProgressBar.java
new file mode 100644
index 0000000..19e55da
--- /dev/null
+++ b/src/com/android/settings/custom/ongoingprogressbar/OngoingProgressBar.java
@@ -0,0 +1,44 @@
+package com.android.settings.custom.ongoingprogressbar;
+
+import android.content.Context;
+import android.os.Bundle;
+
+import com.android.internal.logging.nano.MetricsProto;
+import com.android.settings.R;
+import com.android.settings.SettingsPreferenceFragment;
+import com.android.settings.search.BaseSearchIndexProvider;
+import com.android.settingslib.search.SearchIndexable;
+
+import java.util.List;
+
+@SearchIndexable
+public class OngoingProgressBar extends SettingsPreferenceFragment {
+
+    public static final String TAG = "OngoingProgressBar";
+
+    @Override
+    public void onCreate(Bundle savedInstanceState) {
+        super.onCreate(savedInstanceState);
+
+        addPreferencesFromResource(R.xml.ongoing_progress_settings);
+    }
+
+    @Override
+    public int getMetricsCategory() {
+        return MetricsProto.MetricsEvent.VIEW_UNKNOWN;
+    }
+
+    /**
+     * For search
+     */
+    public static final BaseSearchIndexProvider SEARCH_INDEX_DATA_PROVIDER =
+            new BaseSearchIndexProvider(R.xml.ongoing_progress_settings) {
+
+                @Override
+                public List<String> getNonIndexableKeys(Context context) {
+                    List<String> keys = super.getNonIndexableKeys(context);
+
+                    return keys;
+                }
+            };
+}
-- 
2.43.0

