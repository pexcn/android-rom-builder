From c82da5814f5528f459f669f04ff56e0a7f78e0c7 Mon Sep 17 00:00:00 2001
From: pexcn <pexcn97@gmail.com>
Date: Wed, 21 May 2025 14:07:20 +0000
Subject: [PATCH 2/2] Settings: Introduce Ongoing action chip changes

ref: https://github.com/ProjectMatrixx/android_packages_apps_MatrixxSettings/commit/17f4ddc2b47e8b64c9b38bd65c95f26f0fafd530
Signed-off-by: pexcn <pexcn97@gmail.com>
---
 res/values-zh-rCN/custom_strings.xml          | 24 ++++++++-
 res/values/custom_strings.xml                 | 26 +++++++++-
 res/xml/display_settings.xml                  | 11 ++--
 res/xml/ongoing_progress_settings.xml         | 51 +++++++++++++++++++
 .../OngoingProgressBar.java                   | 44 ++++++++++++++++
 5 files changed, 147 insertions(+), 9 deletions(-)
 create mode 100644 res/xml/ongoing_progress_settings.xml
 create mode 100644 src/com/android/settings/custom/ongoingprogressbar/OngoingProgressBar.java

diff --git a/res/values-zh-rCN/custom_strings.xml b/res/values-zh-rCN/custom_strings.xml
index 735091c..0de463a 100644
--- a/res/values-zh-rCN/custom_strings.xml
+++ b/res/values-zh-rCN/custom_strings.xml
@@ -268,6 +268,28 @@
     <string name="show_qs_on_secure_keyguard_title">快速设置</string>
     <string name="show_qs_on_secure_keyguard_summary">允许在锁屏界面使用快速设置</string>
     <!-- Ongoing action chip -->
+    <string name="ongoing_progress_settings_title">状态栏操作胶囊</string>
+    <string name="ongoing_progress_settings_summary">自定义状态栏操作胶囊</string>
     <string name="ongoing_action_chip_title">通知进度条</string>
-    <string name="ongoing_action_chip_summary">在状态栏中显示通知进度条</string>
+    <string name="ongoing_action_chip_summary">在状态栏中显示下载等正在进行的操作的进度条</string>
+    <string name="show_media_progress_title">显示媒体进度</string>
+    <string name="show_media_progress_summary">在状态栏中显示媒体播放进度</string>
+    <string name="progress_footer_text">
+    "状态栏进度条为媒体播放和活动的上传/下载提供实时更新。
+
+    - 🎵 媒体进度：
+    • 在媒体播放时显示音乐和视频的播放进度。
+    • 轻触可打开播放控件（上一曲、下一曲）。
+    • 双击可切换播放/暂停。
+    • 向左滑动可跳转至上一首曲目。
+    • 向右滑动可跳转至下一首曲目。
+    • 长按可打开媒体应用程序。
+
+    - 📥上传/下载进度：
+    • 显示正在进行的上传和下载进度。
+    • 当未检测到活动的传输时自动隐藏。
+    • 单击可打开负责下载的应用程序。
+
+    进度条在媒体和下载状态之间动态切换，确保您始终可以一目了然地获得最相关的信息。"
+    </string>
 </resources>
diff --git a/res/values/custom_strings.xml b/res/values/custom_strings.xml
index 969ea61..3a42c5a 100644
--- a/res/values/custom_strings.xml
+++ b/res/values/custom_strings.xml
@@ -317,7 +317,29 @@
     <string name="show_qs_on_secure_keyguard_summary">Allow toggling quick settings on secure lockscreen</string>
 
     <!-- Ongoing action chip -->
-    <string name="ongoing_action_chip_title">Enable Ongoing ProgressBar Chip</string>
-    <string name="ongoing_action_chip_summary">Show progressbar chip in statusbar which features ongoing action progress from a notification</string>
+    <string name="ongoing_progress_settings_title">Statusbar action chip</string>
+    <string name="ongoing_progress_settings_summary">Statusbar action chip options</string>
+    <string name="ongoing_action_chip_title">Ongoing action chip</string>
+    <string name="ongoing_action_chip_summary">Show progress indicator in status bar for ongoing actions like downloads</string>
+    <string name="show_media_progress_title">Show media progress</string>
+    <string name="show_media_progress_summary">Display media playback progress in the status bar</string>
+    <string name="progress_footer_text">
+    "The status bar progress bar provides real-time updates for both media playback and active downloads/uploads.
+
+    - 🎵 Media Progress:
+    • Displays playback progress for music and video when media is playing.
+    • Single tap opens playback controls (Previous, Next track).
+    • Double tap toggles play/pause.
+    • Swipe left skips to the previous track.
+    • Swipe right skips to the next track.
+    • Long press opens the media app.
+
+    - 📥Download/Upload Progress:
+    • Shows progress for ongoing downloads and uploads.
+    • Automatically hides when no active transfers are detected.
+    • Single tap opens the app responsible for the download.
+
+    The progress bar dynamically switches between media and download states, ensuring you always have the most relevant information at a glance."
+    </string>
 
 </resources>
diff --git a/res/xml/display_settings.xml b/res/xml/display_settings.xml
index 4c38a13..43c78f8 100644
--- a/res/xml/display_settings.xml
+++ b/res/xml/display_settings.xml
@@ -101,12 +101,11 @@
             <intent android:action="com.android.settings.action.STATUS_BAR_TUNER" />
         </Preference>
 
-        <com.android.settings.custom.preference.SystemSettingSwitchPreference
-            android:key="config_enableOngoingProgressBarChip"
-            android:title="@string/ongoing_action_chip_title"
-            android:summary="@string/ongoing_action_chip_summary"
-            android:defaultValue="false"
-            android:persistent="true"/>
+        <Preference
+            android:key="ongoing_progress_settings"
+            android:title="@string/ongoing_progress_settings_title"
+            android:summary="@string/ongoing_progress_settings_summary"
+            android:fragment="com.android.settings.custom.ongoingprogressbar.OngoingProgressBar" />
     </PreferenceCategory>
 
     <PreferenceCategory
diff --git a/res/xml/ongoing_progress_settings.xml b/res/xml/ongoing_progress_settings.xml
new file mode 100644
index 0000000..4ad2fb9
--- /dev/null
+++ b/res/xml/ongoing_progress_settings.xml
@@ -0,0 +1,51 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!--
+     Copyright (C) 2024-2025 the Lunaris-OS Android Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
+<PreferenceScreen
+    xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:settings="http://schemas.android.com/apk/res/com.android.settings"
+    xmlns:app="http://schemas.android.com/apk/res-auto"
+    android:title="@string/ongoing_progress_settings_title" >
+
+    <com.android.settings.custom.preference.SystemSettingSwitchPreference
+        android:key="ongoing_action_chip"
+        android:title="@string/ongoing_action_chip_title"
+        android:summary="@string/ongoing_action_chip_summary"
+        android:defaultValue="true" />
+
+    <com.android.settings.custom.preference.SystemSettingSwitchPreference
+        android:key="show_media_progress"
+        android:title="@string/show_media_progress_title"
+        android:summary="@string/show_media_progress_summary"
+        android:defaultValue="true" />
+
+    <com.android.settings.custom.preference.SystemSettingSeekBarPreference
+        android:key="progress_bar_opacity"
+        android:title="Progress Bar Opacity"
+        android:summary="Adjust the opacity of the progress bar chip"
+        android:defaultValue="100"
+        settings:units="%"
+        settings:interval="1"
+        android:max="100"
+        android:min="0" />
+
+    <com.android.settingslib.widget.FooterPreference
+        android:key="progress_footer"
+        android:title="@string/progress_footer_text"
+        android:selectable="false"
+        settings:searchable="false" />
+
+</PreferenceScreen>
diff --git a/src/com/android/settings/custom/ongoingprogressbar/OngoingProgressBar.java b/src/com/android/settings/custom/ongoingprogressbar/OngoingProgressBar.java
new file mode 100644
index 0000000..19e55da
--- /dev/null
+++ b/src/com/android/settings/custom/ongoingprogressbar/OngoingProgressBar.java
@@ -0,0 +1,44 @@
+package com.android.settings.custom.ongoingprogressbar;
+
+import android.content.Context;
+import android.os.Bundle;
+
+import com.android.internal.logging.nano.MetricsProto;
+import com.android.settings.R;
+import com.android.settings.SettingsPreferenceFragment;
+import com.android.settings.search.BaseSearchIndexProvider;
+import com.android.settingslib.search.SearchIndexable;
+
+import java.util.List;
+
+@SearchIndexable
+public class OngoingProgressBar extends SettingsPreferenceFragment {
+
+    public static final String TAG = "OngoingProgressBar";
+
+    @Override
+    public void onCreate(Bundle savedInstanceState) {
+        super.onCreate(savedInstanceState);
+
+        addPreferencesFromResource(R.xml.ongoing_progress_settings);
+    }
+
+    @Override
+    public int getMetricsCategory() {
+        return MetricsProto.MetricsEvent.VIEW_UNKNOWN;
+    }
+
+    /**
+     * For search
+     */
+    public static final BaseSearchIndexProvider SEARCH_INDEX_DATA_PROVIDER =
+            new BaseSearchIndexProvider(R.xml.ongoing_progress_settings) {
+
+                @Override
+                public List<String> getNonIndexableKeys(Context context) {
+                    List<String> keys = super.getNonIndexableKeys(context);
+
+                    return keys;
+                }
+            };
+}
-- 
2.43.0

