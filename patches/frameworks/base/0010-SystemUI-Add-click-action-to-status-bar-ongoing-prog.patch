From eda6a7449bd8c94eb610b2acacee25d1587ea0e2 Mon Sep 17 00:00:00 2001
From: Ghosuto <clash.raja10@gmail.com>
Date: Fri, 21 Mar 2025 10:14:55 +0000
Subject: [PATCH 10/24] SystemUI: Add click action to status bar ongoing
 progress chip

Signed-off-by: Ghosuto <clash.raja10@gmail.com>
---
 .../res/drawable/ripple_chip_background.xml   | 25 +++++++++++++++
 .../layout/status_bar_ongoing_action_chip.xml |  9 ++++--
 .../OnGoingActionProgressController.java      | 32 +++++++++++++++++++
 3 files changed, 64 insertions(+), 2 deletions(-)
 create mode 100644 packages/SystemUI/res/drawable/ripple_chip_background.xml

diff --git a/packages/SystemUI/res/drawable/ripple_chip_background.xml b/packages/SystemUI/res/drawable/ripple_chip_background.xml
new file mode 100644
index 000000000..d9db3736b
--- /dev/null
+++ b/packages/SystemUI/res/drawable/ripple_chip_background.xml
@@ -0,0 +1,25 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!--
+  ~ Copyright (C) 2025 Lunaris OS
+  ~
+  ~ Licensed under the Apache License, Version 2.0 (the "License");
+  ~ you may not use this file except in compliance with the License.
+  ~ You may obtain a copy of the License at
+  ~
+  ~      http://www.apache.org/licenses/LICENSE-2.0
+  ~
+  ~ Unless required by applicable law or agreed to in writing, software
+  ~ distributed under the License is distributed on an "AS IS" BASIS,
+  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+  ~ See the License for the specific language governing permissions and
+  ~ limitations under the License.
+  -->
+<ripple xmlns:android="http://schemas.android.com/apk/res/android"
+    android:color="@android:color/system_accent1_500">
+    <item>
+        <shape android:shape="rectangle">
+            <corners android:radius="@dimen/overlay_action_container_corner_radius"/>
+            <solid android:color="@drawable/action_chip_container_background"/>
+        </shape>
+    </item>
+</ripple>
diff --git a/packages/SystemUI/res/layout/status_bar_ongoing_action_chip.xml b/packages/SystemUI/res/layout/status_bar_ongoing_action_chip.xml
index 58997bc7a..b1bcc96f8 100644
--- a/packages/SystemUI/res/layout/status_bar_ongoing_action_chip.xml
+++ b/packages/SystemUI/res/layout/status_bar_ongoing_action_chip.xml
@@ -27,7 +27,10 @@
     android:padding="4sp"
     android:layout_marginLeft="3dp"
     android:visibility="gone"
-    android:background="@drawable/action_chip_container_background">
+    android:background="@drawable/action_chip_container_background"
+    android:clickable="true"
+    android:focusable="true"
+    android:foreground="@drawable/ripple_chip_background">
 
     <ImageView
         android:id="@+id/ongoing_action_app_icon"
@@ -52,6 +55,8 @@
         android:gravity="center_vertical"
         android:indeterminate="false"
         android:progress="0"
-        android:max="100" />
+        android:max="100"
+        android:clickable="false"
+        android:focusable="false" />
 
 </LinearLayout>
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/OnGoingActionProgressController.java b/packages/SystemUI/src/com/android/systemui/statusbar/OnGoingActionProgressController.java
index 22b9423a6..5029b0868 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/OnGoingActionProgressController.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/OnGoingActionProgressController.java
@@ -19,6 +19,7 @@ package com.android.systemui.statusbar;
 import android.app.Notification;
 import android.content.ContentResolver;
 import android.content.Context;
+import android.content.Intent;
 import android.content.res.ColorStateList;
 import android.database.ContentObserver;
 import android.graphics.drawable.Drawable;
@@ -134,6 +135,7 @@ public class OnGoingActionProgressController implements NotificationListener.Not
         
         // Register settings observer
         mSettingsObserver.register();
+        mProgressRootView.setOnClickListener(v -> openTrackedApp());
     }
 
     /** Checks whether notification has progress */
@@ -216,6 +218,36 @@ public class OnGoingActionProgressController implements NotificationListener.Not
         mProgressBar.setProgress(mCurrentProgress);
     }
 
+    /** Handles click action to open the corresponding app */
+    private void openTrackedApp() {
+        if (mTrackedNotificationKey == null || mNotificationListener == null) {
+            Log.w(TAG, "No tracked notification available");
+            return;
+        }
+
+        StatusBarNotification sbn = null;
+        for (StatusBarNotification notification : mNotificationListener.getActiveNotifications()) {
+            if (notification.getKey().equals(mTrackedNotificationKey)) {
+                sbn = notification;
+                break;
+            }
+        }
+
+        if (sbn == null) {
+            Log.w(TAG, "Tracked notification not found");
+            return;
+        }
+
+        String packageName = sbn.getPackageName();
+        Intent launchIntent = mContext.getPackageManager().getLaunchIntentForPackage(packageName);
+        if (launchIntent != null) {
+            launchIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
+            mContext.startActivity(launchIntent);
+        } else {
+            Log.w(TAG, "No launch intent for package: " + packageName);
+        }
+    }
+
     /**
      * Should be called when new notification is posted
      *
-- 
2.43.0

